<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>新建专家评审 - 趣学术</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/activities.css">
    <link rel="stylesheet" href="../css/create-activity.css">
    <link rel="stylesheet" href="../css/create-survey.css">
</head>
<body>
    <!-- 顶部导航栏占位符 -->
    <div id="header-placeholder"></div>

    <!-- 主体布局 -->
    <div class="main-container">
        <!-- 左侧侧边栏占位符 -->
        <div id="sidebar-placeholder"></div>

        <!-- 右侧主要内容区域 -->
        <div class="right-content">
            <!-- 页面标题和操作按钮 -->
            <div class="page-title">
                <button class="action-btn back-btn" onclick="window.location.href='activities.html'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    返回列表
                </button>
                <div class="survey-actions">
                    <button class="action-btn preview-btn" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        预览
                    </button>
                    <button class="action-btn save-btn" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        保存
                    </button>
                    <button class="action-btn publish-btn" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                            <line x1="12" y1="22.08" x2="12" y2="12"></line>
                        </svg>
                        保存并创建
                    </button>
                </div>
            </div>

            <main class="content-area">
                <!-- 内容卡片：基本信息 -->
                <div class="content-card" style="margin-bottom: 16px;">
                    <!-- 基本信息表单 -->
                    <h3 class="section-title">基本信息</h3>
                    <div class="form-row">
                        <div class="form-item full-width">
                            <label for="review-title">评审活动名称 <span class="required">*</span></label>
                            <input type="text" id="review-title" class="form-input" placeholder="请输入评审活动名称" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item">
                            <label for="review-content-type">评审内容类型 <span class="required">*</span></label>
                            <select id="review-content-type" class="form-select" required>
                                <option value="">请选择评审内容类型</option>
                                <option value="medical-podcast">医学播客</option>
                                <option value="online-case">在线病例互动</option>
                            </select>
                        </div>
                        <div class="form-item">
                            <label for="related-content">关联内容 <span class="required">*</span></label>
                            <select id="related-content" class="form-select" required>
                                <option value="">请选择要评审的内容</option>
                                <!-- 这里会根据内容类型动态加载 -->
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item">
                            <label for="review-experts">评审专家 <span class="required">*</span></label>
                            <select id="review-experts" class="form-select" required multiple>
                                <option value="expert1">王教授</option>
                                <option value="expert2">李教授</option>
                                <option value="expert3">张教授</option>
                                <option value="expert4">刘教授</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item">
                            <label for="start-time">评审开始时间 <span class="required">*</span></label>
                            <input type="datetime-local" id="start-time" class="form-input" required>
                        </div>
                        <div class="form-item">
                            <label for="end-time">评审结束时间 <span class="required">*</span></label>
                            <input type="datetime-local" id="end-time" class="form-input" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item">
                            <label for="initial-status">初始状态 <span class="required">*</span></label>
                            <select id="initial-status" class="form-select" required>
                                <option value="pending">待评审</option>
                                <option value="in-review">评审中</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- 内容卡片：评审要求 -->
                <div class="content-card">
                    <!-- 评审要求表单 -->
                    <h3 class="section-title">评审要求</h3>
                    <div class="form-row">
                        <div class="form-item full-width">
                            <label for="review-standard">评审标准 <span class="required">*</span></label>
                            <textarea id="review-standard" class="form-textarea" rows="6" placeholder="请输入评审标准和要求"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-item full-width">
                            <label for="review-dimensions">评审维度 <span class="required">*</span></label>
                            <div class="tag-input-container">
                                <input type="text" id="review-dimensions" class="tag-input" placeholder="添加评审维度">
                            </div>
                            <div class="tags-container"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 加载动画 -->
    <div class="loading" id="loading" style="display: none;">
        <div class="loading-spinner"></div>
        <p>AI正在思考...</p>
    </div>

    <style>
        /* 调整页面标题栏高度 */
        .page-title {
            padding: 14px 20px !important;
        }
        
        /* 调整按钮大小 */
        .survey-actions .action-btn, .back-btn {
            padding: 6px 12px !important;
            font-size: 0.85rem !important;
            height: 32px !important;
        }
        
        /* 调整按钮间距 */
        .survey-actions {
            gap: 8px !important;
        }
        
        /* 调整按钮图标大小 */
        .action-btn svg {
            width: 18px !important;
            height: 18px !important;
        }
        
        /* 移除返回按钮边框 */
        .back-btn {
            border: none !important;
        }
        
        /* 内容区域 */
        .content-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* 内容卡片 */
        .content-card {
            width: 75%;
            margin-left: auto;
            margin-right: auto;
            box-shadow: none;
        }
        
        /* 表单行 */
        .form-row {
            margin-bottom: 15px !important;
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        /* 表单项 */
        .form-item {
            margin-bottom: 0 !important;
            flex: 1;
        }
        
        .form-item.full-width {
            width: 100%;
            flex: none;
        }
        
        .form-item label {
            margin-bottom: 8px !important;
        }
        
        .required {
            color: #ef4444;
            margin-left: 2px;
        }
    </style>
    
    <script src="../js/script.js?v=1"></script>
    <script src="../js/menu.js?v=1"></script>
    <script>
        // 动态加载公共组件
        async function loadComponents() {
            try {
                // 加载顶部导航
                const headerResponse = await fetch('components/header.html');
                const headerHtml = await headerResponse.text();
                document.getElementById('header-placeholder').innerHTML = headerHtml;
                
                // 加载左侧侧边栏
                const sidebarResponse = await fetch('components/sidebar.html');
                const sidebarHtml = await sidebarResponse.text();
                document.getElementById('sidebar-placeholder').innerHTML = sidebarHtml;
                
                // 初始化菜单
                initializeMenu();
            } catch (error) {
                console.error('加载组件失败:', error);
            }
        }
        
        // 页面加载时执行
        window.addEventListener('DOMContentLoaded', loadComponents);
        
        // 评审内容类型切换时，动态加载关联内容
        document.addEventListener('DOMContentLoaded', function() {
            const contentTypeSelect = document.getElementById('review-content-type');
            const relatedContentSelect = document.getElementById('related-content');
            
            if (contentTypeSelect && relatedContentSelect) {
                contentTypeSelect.addEventListener('change', function() {
                    const selectedType = this.value;
                    relatedContentSelect.innerHTML = '<option value="">请选择要评审的内容</option>';
                    
                    // 根据选择的内容类型添加选项
                    if (selectedType === 'medical-podcast') {
                        relatedContentSelect.innerHTML += `
                            <option value="podcast1">心血管疾病防治新进展</option>
                            <option value="podcast2">糖尿病患者管理优化</option>
                            <option value="podcast3">儿科常见疾病诊疗</option>
                        `;
                    } else if (selectedType === 'online-case') {
                        relatedContentSelect.innerHTML += `
                            <option value="case1">糖尿病并发症管理病例征集</option>
                            <option value="case2">心血管疾病治疗新方案病例征集</option>
                            <option value="case3">儿科呼吸系统疾病病例征集</option>
                        `;
                    }
                });
            }
            
            // 标签输入功能
            const tagInput = document.getElementById('review-dimensions');
            const tagsContainer = document.querySelector('.tags-container');
            
            if (tagInput && tagsContainer) {
                tagInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        addTag(this.value.trim());
                        this.value = '';
                    }
                });
            }
            
            function addTag(tagText) {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `${tagText} <span class="tag-remove">×</span>`;
                
                tagElement.querySelector('.tag-remove').addEventListener('click', function() {
                    tagElement.remove();
                });
                
                tagsContainer.appendChild(tagElement);
            }
            
            // 按钮事件处理已移除，按钮已禁用
        });
    </script>
</body>
</html>